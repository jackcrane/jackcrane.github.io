<!DOCTYPE html>
<html>
<head>
	<title>Jack Crane | Lunar Lander</title>
	<script src="https://jackcrane.github.io/static/cdn/jconsole.js" type="text/javascript"></script>
	<script src="devlib.js" type="text/javascript"></script>
	<link href="https://jackcrane.github.io/static/cdn/jfonts.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet">
	<style>
		a {
			color:inherit;
			border:1px solid;
			padding:1%;
			margin:1%;
			background-color:transparent;
			cursor:pointer;
		}
		#canvas {
			border:1px solid;
			
		}
		.canvasParent{
		    overflow:auto;
		    display:inline-block;
		}
	</style>
	<script>
	</script>
</head>
<body style="/*background-color:black;color:white;*/font-family:'Space Age';transition:.2s">
<center><h1>Moon Lander</h1></center>

<center><div class="canvasParent"><canvas id="canvas" width="800" height="520" style="transition:.2s"></canvas></div></center>
<br><br>
<a onclick="killPlayer()">Kill player</a>

<script>

	var keys = new KeysPresses()

	var killGameInstance = false;

	var landerComponent;

	var drawInt = null;

    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);
    document.addEventListener("mousemove", mouseMoveHandler, false);
    document.addEventListener("mousedown", mouseDownHandler, false);
    document.addEventListener("mouseup", mouseUpHandler, false);
    document.addEventListener("mouseclick", mouseClickHandler, false);


	function keyDownHandler(e) {
	    keys.processDownKey(e);
	}
	function keyUpHandler(e) {
	    keys.processUpKey(e);
	}
	function mouseMoveHandler(e) {
	    keys.processMouseMove(e);
	}
	function mouseUpHandler(e) {
	    keys.processMouseUp(e);
	}
	function mouseDownHandler(e) {
	    keys.processMouseDown(e);
	}
	function mouseClickHandler(e) {
	    keys.processMouseClick(e);
	}

	var backgroundImg = 'images/terrain_v2_dark.png';

	var lander = {
		// engUp : 'images/spritesheets/ll_eng_start.png',
		// engDown : 'images/spritesheets/ll_eng_stop.png',
		// engIdle : 'images/spritesheets/ll_eng_idle.png',
		// lander:null,
		// engUpSS:null,
		// engDownSS:null,
		// engIdleSS:null,
		// frameSD:0,
		// frameSkip:0,
	}

	var gameStats = {
		frameCount:0,
	}

	var background = new Image();
	background.src = backgroundImg;

	var health = {
		remainingFuel : 1000,
		remainingRetro : 500,
		remainingOxygen : 1000000,

	}

	var deathCause = null;

	var randomNumber = 0;
	
	var canvas = document.getElementById('canvas');
	var ctx = canvas.getContext("2d");
	
	var game = new GameMaster();

	function drawText() {
		var text = new GameText();
		text.font = "35px Arial";
		text.fillStyle = "Black"
		text.x = 100;
		text.y = 100;
		text.draw("Loading...");
	}

	function killPlayer() {
		health.remainingOxygen = 1;
	}

	function drawScoreText() {
		var text = new GameText();
		text.font = "20px Roboto Mono";
		text.fillStyle = "white";
		// text.alpha = .9;


		text.x = 10;
		text.y = 20;
		if(gameStats.frameCount%2||gameStats.frameCount%3) {
			text.draw("Remaining:");
		}

		text.x = 25;
		text.y = 45;
		if(gameStats.frameCount%2||gameStats.frameCount%3) {
			text.draw("Fuel: " + health.remainingFuel + "");
		}

		text.x = 25;
		text.y = 70;
		if(gameStats.frameCount%2||gameStats.frameCount%3) {
			text.draw("Retro: " + health.remainingRetro);
		}

		text.x = 25;
		text.y = 95;
		if(gameStats.frameCount%2||gameStats.frameCount%3) {
			text.draw("Oxygen: " + health.remainingOxygen);
		}

		text.x = 600;
		text.y = 20;
		text.draw("Frames: " + gameStats.frameCount);
		
	}

	function dir(a) {
		return game.imageDir + a;
	}

	function makeBackgroundOnce() {
		// var background = new Image();
		// background.src = backgroundImg;
		// var rand = randomNumber;
			
		var bg = new ScrollingBackGround(randomNumber,0,13000,2080,3250,520,background);
		bg.draw2();
		
	}

	function makeBackground() {
		makeBackgroundOnce()
	}

	function calcLife() {
		if(gameStats.frameCount%13===0) {
			health.remainingOxygen--;
		}
	}

	function alive() {
		if(health.remainingOxygen >= 0) {
			return true
		} else {
			return false
		}
	}

	function deathCauseFunct() {
		if(health.remainingOxygen <= 0) {
			return "ran out of oxygen"
		}
		console.log('deathCause run')
	}

	function drawDeathScreen() {
		var text = new GameText();
		text.font = "50px Hacked";
		text.fillStyle = "white";
		text.x = 10;
		text.y = 120;
		text.align = 'center';
		text.draw("You crashed!")

		text.x = 10;
		text.y = 320;
		text.align = 'center';
		text.draw("It seems you " + deathCauseFunct())
		// console.log(text)
	}

	function createLander(xpos,ypos) {


		landerComponent = new component(30, 30, "red", 80, 75);



		// var img = new Image();
		// img.src = lander.engUp;
		// console.log(img)
		// lander.engUpSS = new SpriteSheet (xpos,ypos,256,256,64,64,0,6,img);

		// var img = new Image();
		// img.src = lander.engDown;
		// console.log(img)
		// lander.engDownSS = new SpriteSheet (xpos,ypos,256,256,64,64, 0,6,img);

		// var img = new Image();
		// img.src = lander.engIdle;
		// console.log(img)
		// lander.engIdleSS = new SpriteSheet (xpos,ypos,256,256,64,64, 0,0,img);

		// lander.lander = lander.engIdleSS;
	}



	function landerRefresh() {
	// 	if(!keys.upArrow) {
	// 		lander.lander.currentFrame = 0;
	// 	}

	// 	if(keys.upArrow) {
	// 		lander.lander = lander.engUpSS;
	// 	} else if(keys.downArrow) {
	// 		lander.lander = lander.engDownSS;
	// 	} else {
	// 		lander.lander = lander.engIdleSS;
	// 		// lander.lander.currentFrame = 0;
	// 	}
		
	// 	lander.frameSD ++
	// 	if(lander.frameSD == 50) {
	// 		lander.frameSkip ++
	// 		lander.lander.advanceFrame()
	// 		// console.log(lander.frameSD)	
	// 		lander.frameSD = 0;
	// 	}
	}

	function landerSpoolUp() {
		// if(keys.upArrow) {
		// 	for(let i = 0; i<7; i++) {
		// 		lander.lander.advanceFrame()
		// 	}
		// }
	}

	function draw() {
		gameStats.frameCount++;
		if(gameStats.frameCount%10 == 0) {
			ctx.fillStyle = "black";
			ctx.fillRect(0, 0, canvas.width, canvas.height);
			
			calcLife();
			if(alive()) {
				drawText();
				makeBackground();
				drawScoreText();
				// landerRefresh();
				// lander.lander.draw()
				landerComponent.newPos();
    			landerComponent.update();
			} else {
				drawDeathScreen();
			}

			if(killGameInstance) {
				clearInterval(drawInt)
			}
		}
		drawInt = setInterval(draw, 0.1)

		

	}

		makeBackgroundOnce()
		createLander(300,30)

		draw();

		

		randomNumber = Math.floor(Math.random() * 1200) + 1;

	// darkModeToggle()

</script>


</body>
</html>